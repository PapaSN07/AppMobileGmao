<p-toast />

<div class="mb-6 flex justify-between items-center flex-wrap gap-4">
  <div>
    <h1 class="text-3xl font-semibold text-surface-900 dark:text-surface-0 mb-2">
      Tableau de bord des statistiques
    </h1>
    <p class="text-muted-color flex items-center gap-2">
      <i class="pi pi-clock"></i>
      <span>Dernière mise à jour : {{ lastUpdated() }}</span>
    </p>
  </div>
  
  <p-button 
    icon="pi pi-refresh" 
    label="Actualiser" 
    severity="secondary"
    [loading]="loading()"
    (onClick)="onRefresh()"
  />
</div>

<!-- Cartes KPI -->
<div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
  @for (card of statsCards(); track card.title) {
    <app-stats-card
      [title]="card.title"
      [value]="card.value"
      [icon]="card.icon"
      [color]="card.color"
      [bgColor]="card.bgColor"
      [trend]="card.trend"
      [loading]="loading()"
    />
  }
</div>

<!-- Graphiques et Tableau -->
@if (statistics()) {
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Graphique Entités -->
    @if (statistics()!.stats_by_entity && statistics()!.stats_by_entity!.length > 0) {
      <app-entity-chart [data]="statistics()!.stats_by_entity!" />
    }
    
    <!-- Graphique Familles -->
    @if (statistics()!.stats_by_family && statistics()!.stats_by_family!.length > 0) {
      <app-family-chart [data]="statistics()!.stats_by_family!" />
    }
    
    <!-- Tableau Utilisateurs (pleine largeur) -->
    @if (statistics()!.stats_by_user && statistics()!.stats_by_user!.length > 0) {
      <div class="lg:col-span-2">
        <app-user-stats-table [data]="statistics()!.stats_by_user!" />
      </div>
    }
  </div>
} @else {
  <p-progressSpinner></p-progressSpinner>
}