<div class="card">
    <div class="font-semibold text-xl mb-4">Liste des prestataires crÃ©Ã©s</div>

    <div>
        <p-table
            #dt
            [value]="users"
            dataKey="id"
            [rows]="5"
            [rowsPerPageOptions]="[5, 10, 25, 50]"
            [rowHover]="true"
            [expandedRowKeys]="expandedRows"
            [loading]="loading"
            [paginator]="true"
            [(selection)]="selection"
            [globalFilterFields]="['username', 'email', 'company', 'urlName', 'isConnected', 'isEnabled', 'createdAt', 'address']"
            [tableStyle]="{ 'min-width': '75rem' }"
            [scrollable]="true"
        >
            <ng-template #caption>
                <div class="flex justify-between md:flex-row flex-col gap-2">
                    <p-button iconPosition="right" icon="pi pi-filter-slash" (click)="clear(dt)" label="Effacer" severity="secondary" />
                    <p-iconfield iconPosition="left" class="ml-auto">
                        <p-inputicon>
                            <i class="pi pi-search"></i>
                        </p-inputicon>
                        <input pInputText type="text" (input)="dt.filterGlobal($event.target.value, 'contains')" placeholder="Recherche par mot-clÃ©" />
                    </p-iconfield>
                </div>
            </ng-template>
            <ng-template #header>
                <tr>
                    <th>
                    </th>
                    <th>
                        <p-columnFilter type="text" field="username" placeholder="Rechercher par ..." ariaLabel="Filtre Username" filterOn="input"></p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter type="text" field="email" placeholder="Rechercher par ..." ariaLabel="Filtre Email" filterOn="input"></p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter type="text" field="company" placeholder="Rechercher par ..." ariaLabel="Filtre SociÃ©tÃ©" filterOn="input"></p-columnFilter>
                    </th>
                    <th>
                        <p-columnFilter type="text" field="address" placeholder="Rechercher par ..." ariaLabel="Filtre Adresse" filterOn="input"></p-columnFilter>
                    </th>
                    <th style="width: auto; min-width: 10rem">
                        <div class="flex items-center justify-between">
                            Date
                            <p-columnFilter type="date" field="createdAt" display="menu"></p-columnFilter>
                        </div>
                    </th>
                    <th style="width: auto; min-width: 10rem">
                        <div class="flex items-center justify-between">
                            Statut
                            <p-columnFilter type="boolean" field="isConnected" display="menu" />
                        </div>
                    </th>
                    <th style="width: auto; min-width: 10rem">
                        <div class="flex items-center justify-between">
                            Statut
                            <p-columnFilter type="boolean" field="isEnabled" display="menu" />
                        </div>
                    </th>
                    <th style="width: auto; min-width: 7.5rem" pFrozenColumn alignFrozen="right" [frozen]="balanceFrozen"></th>
                </tr>
                <tr>
                    <th style="width: 11%">Image</th>
                    <th style="width: 11%">Nom Utilisateur</th>
                    <th style="width: 11%">Email</th>
                    <th style="width: 11%">SociÃ©tÃ©</th>
                    <th style="width: 11%">Adresse</th>
                    <th style="width: 11%">Date de CrÃ©ation</th>
                    <th style="width: 11%">Est ConnectÃ©</th>
                    <th style="width: 11%">Compte ActivÃ©</th>
                    <th style="width: auto; min-width: 7.5rem" pFrozenColumn alignFrozen="right" [frozen]="balanceFrozen">Actions</th>
                </tr>
            </ng-template>
            <ng-template #body let-user let-expanded="expanded">
                <tr>
                    <td>
                        @if (user.urlName) {
                            <img [src]="user.urlName" alt="Photo" width="50" height="50" style="border-radius: 50%;" />
                        } @else {
                            <img src="assets/images/profile.svg" alt="Default Photo" width="50" height="50" style="border-radius: 50%;" />
                        }
                    </td>
                    <td>{{ user.username || 'N/A' }}</td>
                    <td>{{ user.email || 'N/A' }}</td>
                    <td>{{ user.company || 'N/A' }}</td>
                    <td>{{ user.address || 'N/A' }}</td>
                    <td>{{ (user.createdAt | date:'dd/MM/yyyy HH:mm') || 'N/A' }}</td>
                    <td>
                        @if(user.isConnected) {
                            <p-tag icon="pi pi-check" severity="success" rounded="true" />
                        } @else {
                            <p-tag icon="pi pi-times" severity="danger" rounded="true" />
                        }
                    </td>
                    <td>
                        @if (user.isEnabled) {
                            <p-tag icon="pi pi-check" severity="success" rounded="true" />
                        } @else {
                            <p-tag icon="pi pi-times" severity="danger" rounded="true" />
                        }
                    </td>
                    <td alignFrozen="right" pFrozenColumn [frozen]="balanceFrozen" class="p-2">
                        <p-confirmpopup />
                        <p-button (onClick)="confirm1($event, user)" class="mr-2" icon="pi pi-check" [outlined]="true" [rounded]="true" />
                        <p-button (onClick)="confirm2($event, user)" icon="pi pi-times" severity="danger" [outlined]="true" [rounded]="true" />
                    </td>
                </tr>
            </ng-template>
            <ng-template #loadingbody>
                <tr>
                    <td colspan="14">Chargement des donnÃ©es des Utilisateur. Veuillez patienter ğŸ«¸ğŸ½ğŸ«¸ğŸ½ğŸ«¸ğŸ½.</td>
                </tr>
            </ng-template>
            <ng-template #emptymessage>
                <tr>
                    <td colspan="9">Pas de donnÃ©es disponibles ğŸ˜”ğŸ˜”ğŸ˜”.</td>
                </tr>
            </ng-template>
        </p-table>
    </div>
</div>
